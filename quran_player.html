<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مشغل القرآن الكريم - وليد النائحي</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --background-color: #ecf0f1;
            --text-color: #333;
            --light-grey: #bdc3c7;
            --white: #ffffff;
        }

        body {
            font-family: 'Cairo', sans-serif;
            margin: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        .sidebar {
            width: 350px;
            background-color: var(--white);
            border-left: 1px solid var(--light-grey);
            display: flex;
            flex-direction: column;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
        }

        .sidebar-header {
            padding: 20px;
            background-color: var(--primary-color);
            color: var(--white);
            font-size: 1.2rem;
            text-align: center;
        }

        .athman-list {
            list-style: none;
            padding: 0;
            margin: 0;
            overflow-y: auto;
            flex-grow: 1;
        }

        .athman-list li {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .athman-list li:hover {
            background-color: #f8f9fa;
        }

        .athman-list li.active {
            background-color: var(--secondary-color);
            color: var(--white);
            font-weight: bold;
        }

        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .image-container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: hidden;
            background-color: #e9e9e9;
        }

        #quranImage {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 5px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .player-controls {
            background-color: var(--white);
            padding: 15px 20px;
            border-top: 1px solid var(--light-grey);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        .top-controls, .bottom-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        }

        .top-controls {
             margin-bottom: 10px;
        }
        
        .playback-controls button {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--primary-color);
        }

        .playback-controls button:hover {
            color: var(--secondary-color);
        }

        #timeline-container {
            flex-grow: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #timeline {
            width: 100%;
            cursor: pointer;
        }

        .title-display {
            text-align: center;
            font-size: 1rem;
            font-weight: bold;
            padding: 5px 0;
        }

        .advanced-controls {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .advanced-controls label {
            font-size: 0.9rem;
        }
        
        .advanced-controls select, .advanced-controls input {
            padding: 5px;
            border-radius: 5px;
            border: 1px solid var(--light-grey);
        }

        .advanced-controls input[type="number"] {
            width: 60px;
        }

    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="sidebar-header" id="hizbTitle"></div>
        <ul class="athman-list" id="athmanList">
            </ul>
    </aside>

    <main class="main-content">
        <div class="image-container">
            <img id="quranImage" src="https://via.placeholder.com/800x1200/ffffff/333333?text=اختر+ثمنا+للبدء" alt="صفحة المصحف">
        </div>
        
        <div class="player-controls">
            <div class="title-display" id="currentThumnTitle"></div>
             <div class="top-controls">
                <div class="playback-controls">
                    <button id="prevBtn">⏮</button>
                    <button id="playPauseBtn">⏯</button>
                    <button id="nextBtn">⏭</button>
                </div>
                <div id="timeline-container">
                    <span id="currentTime">0:00</span>
                    <input type="range" id="timeline" value="0" step="1">
                    <span id="totalTime">0:00</span>
                </div>
            </div>
            <div class="bottom-controls">
                 <div class="advanced-controls">
                    <label for="speedControl">السرعة:</label>
                    <select id="speedControl">
                        <option value="0.75">0.75x</option>
                        <option value="1" selected>عادية</option>
                        <option value="1.25">1.25x</option>
                        <option value="1.5">1.5x</option>
                    </select>
                </div>
                 <div class="advanced-controls">
                    <label for="repeatCount">التكرار:</label>
                    <input type="number" id="repeatCount" min="1" value="1">
                </div>
            </div>
        </div>
        <audio id="audioPlayer"></audio>
    </main>

    <script>
        // =======================================================
        //  الجزء الذي تم تصحيحه بناءً على معلوماتك
        // =======================================================

        const GITHUB_BASE_URL = "https://raw.githubusercontent.com/abuabdalaala/quran_nayhy/main/audio/audio/hizb_01/";

        const quranData = [
            {
                hizb_number: 1,
                hizb_name: "01-حزب الفاتحة",
                athman: [
                    { thumn_name: "001- الحمد لله رب العالمين", audio_file: "thumn_001.mp3" },
                    { thumn_name: "002- وإذا لقوا الذين آمنوا قالوا آمنا وإذا خلوا إلى شياطينهم قالوا إنا معكم", audio_file: "thumn_002.mp3" },
                    { thumn_name: "003- إن الله لا يستحيي أن يضرب مثلا ما بعوضة فما فوقها", audio_file: "thumn_003.mp3" },
                    { thumn_name: "004- وإذ قلنا للملائكة اسجدوا لآدم فسجدوا إلا إبليس أبى واستكبر", audio_file: "thumn_004.mp3" },
                    { thumn_name: "005- أتأمرون الناس بالبر وتنسون أنفسكم وأنتم تتلون الكتاب", audio_file: "thumn_005.mp3" },
                    { thumn_name: "006- وإذ قال موسى لقومه يا قوم إنكم ظلمتم أنفسكم", audio_file: "thumn_006.mp3" },
                    { thumn_name: "007- وإذ استسقى موسى لقومه فقلنا اضرب بعصاك الحجر", audio_file: "thumn_007.mp3" },
                    { thumn_name: "008- وإذ قال موسى لقومه إن الله يأمركم أن تذبحوا بقرة", audio_file: "thumn_008.mp3" }
                ]
            }
        ];
        
        // =======================================================
        // باقي الكود كما هو بدون تغيير
        // =======================================================

        const hizbTitle = document.getElementById('hizbTitle');
        const athmanList = document.getElementById('athmanList');
        const quranImage = document.getElementById('quranImage');
        const audioPlayer = document.getElementById('audioPlayer');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const speedControl = document.getElementById('speedControl');
        const repeatCountInput = document.getElementById('repeatCount');
        const currentThumnTitle = document.getElementById('currentThumnTitle');
        const timeline = document.getElementById('timeline');
        const currentTimeEl = document.getElementById('currentTime');
        const totalTimeEl = document.getElementById('totalTime');

        let currentHizbIndex = 0;
        let currentThumnIndex = 0;
        let repeatCounter = 0;
        let isPlaying = false;

        function populateAthmanList() {
            const hizb = quranData[currentHizbIndex];
            hizbTitle.textContent = hizb.hizb_name;
            athmanList.innerHTML = '';
            hizb.athman.forEach((thumn, index) => {
                const li = document.createElement('li');
                li.textContent = thumn.thumn_name;
                li.dataset.index = index;
                li.addEventListener('click', () => {
                    currentThumnIndex = index;
                    loadThumn(true);
                });
                athmanList.appendChild(li);
            });
        }

        function loadThumn(playImmediately = false) {
            const hizb = quranData[currentHizbIndex];
            const thumn = hizb.athman[currentThumnIndex];

            audioPlayer.src = GITHUB_BASE_URL + thumn.audio_file;
            
            const thumnNumberForImage = currentThumnIndex + 1;
            quranImage.src = `https://via.placeholder.com/800x1200/ffffff/333333?text=صورة+الثمن+رقم+${thumnNumberForImage}`;
            
            currentThumnTitle.textContent = thumn.thumn_name;
            repeatCounter = parseInt(repeatCountInput.value);

            updateActiveListItem();

            if (playImmediately) {
                audioPlayer.play();
            }
        }

        function updateActiveListItem() {
            const listItems = athmanList.querySelectorAll('li');
            listItems.forEach((item, index) => {
                if (index === currentThumnIndex) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }
        
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
        }

        playPauseBtn.addEventListener('click', () => {
            if (audioPlayer.paused) {
                audioPlayer.play();
            } else {
                audioPlayer.pause();
            }
        });

        audioPlayer.addEventListener('play', () => {
            isPlaying = true;
            playPauseBtn.textContent = '⏸';
        });

        audioPlayer.addEventListener('pause', () => {
            isPlaying = false;
            playPauseBtn.textContent = '⏯';
        });
        
        audioPlayer.addEventListener('loadedmetadata', () => {
            totalTimeEl.textContent = formatTime(audioPlayer.duration);
            timeline.max = audioPlayer.duration;
        });

        audioPlayer.addEventListener('timeupdate', () => {
            currentTimeEl.textContent = formatTime(audioPlayer.currentTime);
            timeline.value = audioPlayer.currentTime;
        });
        
        timeline.addEventListener('input', () => {
            audioPlayer.currentTime = timeline.value;
        });

        nextBtn.addEventListener('click', () => {
            currentThumnIndex++;
            if (currentThumnIndex >= quranData[currentHizbIndex].athman.length) {
                currentThumnIndex = 0;
            }
            loadThumn(isPlaying);
        });

        prevBtn.addEventListener('click', () => {
            currentThumnIndex--;
            if (currentThumnIndex < 0) {
                currentThumnIndex = quranData[currentHizbIndex].athman.length - 1;
            }
            loadThumn(isPlaying);
        });
        
        speedControl.addEventListener('change', () => {
            audioPlayer.playbackRate = parseFloat(speedControl.value);
        });

        audioPlayer.addEventListener('ended', () => {
            repeatCounter--;
            if (repeatCounter > 0) {
                audioPlayer.currentTime = 0;
                audioPlayer.play();
            } else {
                nextBtn.click();
            }
        });

        populateAthmanList();
    </script>

</body>
</html>
