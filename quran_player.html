<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>موقع القرآن الكريم - بصوت وليد النايحي</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <style>
        :root {
            --primary-bg: #F8F9FA;
            --secondary-bg: #FFFFFF;
            --accent-color: #2E86C1;
            --text-primary: #212529;
            --text-secondary: #6C757D;
            --border-color: #DEE2E6;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        * { box-sizing: border-box; }
        html, body {
            height: 100%;
            margin: 0;
            overflow: hidden;
        }
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
        }
        .top-section {
            background-color: var(--secondary-bg);
            border-bottom: 1px solid var(--border-color);
            z-index: 20;
            flex-shrink: 0;
        }
        .header {
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px; /* Gap between button, selector, and search */
        }
        
        /* New Styles for Centered Download Button */
        .download-container {
            display: flex;
            justify-content: center;
        }
        #downloadHizbBtn {
            width: 90%;
            max-width: 400px;
            padding: 12px 20px;
            font-size: 1rem;
            font-weight: 700;
            color: white;
            background-color: var(--accent-color);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #downloadHizbBtn:hover {
            background-color: #2471A3;
        }

        #hizbSelector {
            width: 100%;
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            font-size: 1rem;
            font-weight: 700;
        }
        .search-container {
            width: 100%;
        }
        #searchInput {
            width: 100%;
            padding: 11px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            font-size: 0.9rem;
        }
        .athman-list-container {
            overflow-x: auto;
            white-space: nowrap;
            padding: 10px 0;
            border-top: 1px solid var(--border-color);
        }
        .athman-list {
            list-style: none;
            padding: 0 10px;
            margin: 0;
            display: inline-flex;
            gap: 10px;
        }
        .athman-list-item {
            padding: 8px 15px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            min-width: 50px;
            text-align: center;
        }
        .athman-list-item.active {
            background-color: var(--accent-color);
            color: var(--secondary-bg);
            border-color: var(--accent-color);
            font-weight: bold;
        }
        .main-content {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto; 
        }
        #quranImage {
            width: auto;
            height: 100%;
            max-width: 100%;
            object-fit: contain;
        }
        .player-container {
            background-color: var(--secondary-bg);
            border-top: 1px solid var(--border-color);
            padding: 15px 20px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        #currentThumnTitle {
            text-align: center;
            font-size: 1.1rem;
            font-weight: 700;
            min-height: 30px; 
        }
        .timeline-container { 
            display: flex; 
            align-items: center; 
            gap: 15px; 
        }
        .time-display { font-size: 0.85rem; }
        
        .all-controls-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 25px;
            width: 100%;
            margin-top: 5px;
            flex-wrap: wrap;
        }
        .player-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            order: 2; /* Main controls in the middle */
        }
        .player-controls button {
            background: none; border: none; font-size: 2.2rem;
            cursor: pointer; color: var(--text-primary);
        }
        .control-group { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }
        .control-group label { font-size: 0.9rem; }
        .control-group select, .control-group input {
            padding: 6px 8px; border-radius: 6px;
            border: 1px solid var(--border-color);
            font-size: 0.85rem;
        }
        .control-group input[type="number"] { width: 60px; }

        #repeatControlGroup { order: 1; }
        #speedControlGroup { order: 3; }

        .loading-overlay {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center; align-items: center;
            z-index: 1000;
            font-size: 1.5rem; font-weight: 700;
        }
    </style>
</head>
<body>
    <div id="loadingOverlay" class="loading-overlay"></div>

    <div class="top-section">
        <header class="header">
            <div class="download-container">
                <button id="downloadHizbBtn">تحميل الحزب</button>
            </div>
            <select id="hizbSelector"></select>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="ابحث في جميع الأحزاب...">
            </div>
        </header>
        <div class="athman-list-container">
            <ul class="athman-list" id="athmanList"></ul>
        </div>
    </div>

    <main class="main-content">
        <img id="quranImage" src="https://raw.githubusercontent.com/abuabdalaala/quran_nayhy/main/images/cover.jpg" alt="مصحف القارئ وليد النايحي">
    </main>

    <footer class="player-container">
        <div id="currentThumnTitle">اختر ثمنًا للبدء</div>
        <div class="timeline-container">
            <span class="time-display" id="currentTime">0:00</span>
            <input type="range" id="timeline" value="0" step="1" style="width: 100%;">
            <span class="time-display" id="totalTime">0:00</span>
        </div>
        <div class="all-controls-container">
            <div id="repeatControlGroup" class="control-group">
                <label for="repeatCount">التكرار:</label>
                <input type="number" id="repeatCount" min="1" value="1">
            </div>
            <div class="player-controls">
                <button id="prevBtn" title="الثمن السابق">⏮</button>
                <button id="playPauseBtn" title="تشغيل/إيقاف">⏯</button>
                <button id="nextBtn" title="الثمن التالي">⏭</button>
            </div>
            <div id="speedControlGroup" class="control-group">
                <label for="speedControl">السرعة:</label>
                <select id="speedControl">
                    <option value="0.75">0.75x</option>
                    <option value="1" selected>عادية</option>
                    <option value="1.25">1.25x</option>
                    <option value="1.5">1.5x</option>
                </select>
            </div>
        </div>
    </footer>

    <audio id="audioPlayer" style="display:none;"></audio>

    <script>
        // DOM Elements
        const hizbSelector = document.getElementById('hizbSelector');
        const athmanList = document.getElementById('athmanList');
        const searchInput = document.getElementById('searchInput');
        const quranImage = document.getElementById('quranImage');
        const audioPlayer = document.getElementById('audioPlayer');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const speedControl = document.getElementById('speedControl');
        const repeatCountInput = document.getElementById('repeatCount');
        const currentThumnTitle = document.getElementById('currentThumnTitle');
        const timeline = document.getElementById('timeline');
        const currentTimeEl = document.getElementById('currentTime');
        const totalTimeEl = document.getElementById('totalTime');
        const downloadHizbBtn = document.getElementById('downloadHizbBtn');
        const loadingOverlay = document.getElementById('loadingOverlay');
        
        // GitHub Config
        const GITHUB_USER = "abuabdalaala";
        const GITHUB_REPO = "quran_nayhy";
        const GITHUB_BRANCH = "main";
        const GITHUB_RAW_BASE_URL = `https://raw.githubusercontent.com/${GITHUB_USER}/${GITHUB_REPO}/${GITHUB_BRANCH}/`;

        // Data
        const thumnTitles = [
            "الحمد لله رب العالمين", "وإذا لقوا الذين آمنوا قالوا آمنا وإذا خلوا إلى شياطينهم قالوا إنا معكم", "إن الله لا يستحيي أن يضرب مثلا ما بعوضة فما فوقها", "وإذ قلنا للملائكة اسجدوا لآدم فسجدوا إلا إبليس أبى واستكبر", "أتأمرون الناس بالبر وتنسون أنفسكم وأنتم تتلون الكتاب", "وإذ قال موسى لقومه يا قوم إنكم ظلمتم أنفسكم", "وإذ استسقى موسى لقومه فقلنا اضرب بعصاك الحجر", "وإذ قال موسى لقومه إن الله يأمركم أن تذبحوا بقرة", "وإذا لقوا الذين آمنوا قالوا آمنا وإذا خلا بعضهم إلى بعض قالوا أتحدثونهم", "وإن يأتوكم أسارى تفادوهم وهو محرم عليكم إخراجهم",
            "ولقد جاءكم موسى بالبينات ثم اتخذتم العجل من بعده وأنتم ظالمون", "واتبعوا ما تتلوا الشياطين على ملك سليمان وما كفر سليمان", "ما ننسخ من آية أو ننسها نأت بخير منها أو مثلها", "ولله المشرق والمغرب فأينما تولوا فثم وجه الله", "وإذ ابتلى إبراهيم ربه بكلمات فأتمهن", "أم كنتم شهداء إذ حضر يعقوب الموت إذ قال لبنيه", "سيقول السفهاء من الناس ما ولاهم عن قبلتهم التي كانوا عليها", "ولكل وجهة هو موليها فاستبقوا الخيرات", "إن الصفا والمروة من شعائر الله", "يا أيها الناس كلوا مما في الأرض حلالا طيبا",
            "ليس البر أن تولوا وجوهكم قبل المشرق والمغرب", "شهر رمضان الذي أنزل فيه القرءان", "يسألونك عن الأهلة قل هي مواقيت للناس والحج", "الحج أشهر معلومات فمن فرض فيهن الحج فلا رفث", "واذكروا الله في أيام معدودات", "كان الناس أمة واحدة فبعث الله النبيئين", "يسألونك عن الخمر والميسر قل فيهما إثم كبير", "والمطلقات يتربصن بأنفسهن ثلاثة قروء", "والوالدات يرضعن أولادهن حولين كاملين", "لا جناح عليكم إن طلقتم النساء ما لم تمسوهن",
            "ألم تر إلى الذين خرجوا من ديارهم وهم ألوف حذر الموت", "وقال لهم نبيئهم إن آية ملكه أن يأتيكم التابوت", "تلك الرسل فضلنا بعضهم على بعض", "ألم تر إلى الذي حاج إبراهيم في ربه", "قول معروف ومغفرة خير من صدقة يتبعها أذى", "يا أيها الذين آمنوا أنفقوا من طيبات ما كسبتم", "ليس عليك هداهم ولكن الله يهدي من يشاء", "يا أيها الذين آمنوا إذا تداينتم بدين إلى أجل مسمى فاكتبوه", "وإن كنتم على سفر ولم تجدوا كاتبا فرهان مقبوضة", "إن الله لا يخفى عليه شيء في الأرض ولا في السماء",
            "قل أؤنبئكم بخير من ذالكم للذين اتقوا عند ربهم جنات", "قل اللهم مالك الملك تؤتي الملك من تشاء", "إن الله اصطفى آدم ونوحا وآل إبراهيم وآل عمران", "وإذ قالت الملائكة يا مريم إن الله اصطفاك", "فلما أحس عيسى منهم الكفر قال من أنصاري إلى الله", "قل يا أهل الكتاب تعالوا إلى كلمة سواء بيننا وبينكم", "ومن أهل الكتاب من إن تأمنه بقنطار يؤده إليك", "أفغير دين الله تبغون وله أسلم من في السماوات والأرض", "لن تنالوا البر حتى تنفقوا مما تحبون", "ولتكن منكم أمة يدعون إلى الخير",
            "ليسوا سواء من أهل الكتاب أمة قائمة", "وإذ غدوت من أهلك تبوئ المؤمنين مقاعد للقتال", "سارعوا إلى مغفرة من ربكم وجنة عرضها السماوات والأرض", "وما محمد إلا رسول قد خلت من قبله الرسل", "إذ تصعدون ولا تلوون على أحد والرسول يدعوكم في أخراكم", "إن ينصركم الله فلا غالب لكم", "يستبشرون بنعمة من الله وفضل", "ما كان الله ليذر المؤمنين على ما أنتم عليه", "لتبلون في أموالكم وأنفسكم ولتسمعن", "فاستجاب لهم ربهم أني لا أضيع عمل عامل منكم",
            "وابتلوا اليتامى حتى إذا بلغوا النكاح", "يوصيكم الله في أولادكم للذكر مثل حظ الأنثيين", "تلك حدود الله ومن يطع الله ورسوله ندخله جنات", "يا أيها الذين آمنوا لا يحل لكم أن ترثوا النساء كرها", "والمحصنات من النساء إلا ما ملكت أيمانكم", "إن تجتنبوا كبائر ما تنهون نكفر عنكم سيئاتكم", "واعبدوا الله ولا تشركوا به شيئا", "يا أيها الذين أوتوا الكتاب آمنوا بما نزلنا مصدقا لما معكم", "إن الله يأمركم أن تؤدوا الأمانات إلى أهلها", "وما أرسلنا من رسول إلا ليطاع بإذن الله",
            "فليقاتل في سبيل الله الذي يشرون الحياة الدنيا بالآخرة", "أينما تكونوا يدرككم الموت ولو كنتم في بروج مشيدة", "الله لا إله إلا هو ليجمنعكم إلى يوم القيامة لا ريب فيه", "ومن يقتل مؤمنا متعمدا فجزاؤه جهنم خالدا فيها", "ومن يهاجر في سبيل الله يجد في الأرض مراغما كثيرا وسعة", "إنا أنزلنا إليك الكتاب بالحق لتحكم بين الناس بما أراك الله", "لا خير في كثير من نجواهم إلا من أمر بصدقة أو معروف", "ليس بأمانيكم ولا أماني أهل الكتاب", "وإن يتفرقا يغن الله كلا من سعته", "بشر المنافقين بأن لهم عذابا أليما",
            "لا يحب الله الجهر بالسوء من القول إلا من ظلم", "وإن من أهل الكتاب إلا ليؤمنن به قبل موته", "لكن الله يشهد بما أنزل إليك أنزله بعلمه", "لن يستنكف المسيح أن يكون عبدا لله ولا الملائكة المقربون", "حرمت عليكم الميتة والدم ولحم الخنزير وما أهل لغير الله به", "يا أيها الذين آمنوا إذا قمتم إلى الصلاة فاغسلوا وجوهكم", "ولقد أخذ الله ميثاق بني إسرائيل وبعثنا منهم اثني عشر نقيبا", "لقد كفر الذين قالوا إن الله هو المسيح ابن مريم", "قال رجلان من الذين يخافون أنعم الله عليهما", "من أجل ذلك كتبنا على بني إسرائيل أنه من قتل نفسا",
            "يا أيها الرسول لا يحزنك الذين يسارعون في الكفر", "وكتبنا عليهم فيها أن النفس بالنفس", "وأن احكم بينهم بما أنزل الله ولا تتبع أهواءهم واحذرهم", "قل يا أهل الكتاب هل تنقمون منا إلا أن آمنا بالله", "يا أيها الرسول بلغ ما أنزل إليك من ربك", "ما المسيح ابن مريم إلا رسول قد خلت من قبله الرسل", "لتجدن أشد الناس عداوة للذين آمنوا اليهود والذين أشركوا", "يا أيها الذين آمنوا إنما الخمر والميسر والأنصاب والأزلام رجس", "جعل الله الكعبة البيت الحرام قياما للناس", "يا أيها الذين آمنوا شهادة بينكم إذا حضر أحدكم الموت",
            "وإذ أوحيت إلى الحواريين أن آمنوا بي وبرسولي", "الحمد لله الذي خلق السماوات والأرض وجعل الظلمات والنور", "وله ما سكن في الليل والنهار وهو السميع العليم", "ومنهم من يستمع إليك وجعلنا على قلوبهم أكنة", "إنما يستجيب الذين يسمعون والموتى يبعثهم الله", "قل لا أقول لكم عندي خزائن الله ولا أعلم الغيب", "وعنده مفاتح الغيب لا يعلمها إلا هو", "وذر الذين اتخذوا دينهم لعبا ولهوا وغرتهم الحياة الدنيا", "وحاجه قومه قال أتحاجوني في الله وقد هدان", "وما قدروا الله حق قدره إذ قالوا ما أنزل الله على بشر من شيء",
            "إن الله فالق الحب والنوى يخرج الحي من الميت", "وجعلوا لله شركاء الجن وخلقهم", "ولو أننا نزلنا إليهم الملائكة وكلمهم الموتى", "وذروا ظاهر الإثم وباطنه", "لهم دار السلام عند ربهم وهو وليهم", "وجعلوا لله مما ذرأ من الحرث والأنعام نصيبا", "وهو الذي أنشأ جنات معروشات وغير معروشات", "قل لا أجد في ما أوحي إلي محرما على طاعم يطعمه إلا أن يكون", "قل تعالوا أتلو ما حرم ربكم عليكم", "هل ينظرون إلا أن تأتيهم الملائكة أو يأتي ربك",
            "ألمص كتاب أنزل إليك فلا يكن في صدرك حرج منه", "ويا آدم اسكن أنت وزوجك الجنة", "قل أمر ربي بالقسط وأقيموا وجوهكم عند كل مسجد", "قال ادخلوا في أمم قد خلت من قبلكم من الجن والإنس في النار", "وإذا صرفت أبصارهم تلقا أصحاب النار", "ادعوا ربكم تضرعا وخفية إنه لا يحب المعتدين", "وإلى عاد أخاهم هودا قال يا قوم اعبدوا الله", "قال الملأ الذين استكبروا من قومه للذين استضعفوا", "قال الملأ الذين استكبروا من قومه لنخرجنك يا شعيب", "أولم يهد للذين يرثون الأرض من بعد أهلها",
            "وأوحينا إلى موسى أن ألق عصاك", "وقالوا مهما تأتنا به من آية لتسحرنا بها فما نحن لك بمؤمنين", "وواعدنا موسى ثلاثين ليلة وأتممناها بعشر", "واتخذ قوم موسى من بعده من حليهم عجلا جسدا له خوار", "واكتب لنا في هذه الدنيا حسنة وفي الآخرة إنا هدنا إليك", "وسئلهم عن القرية التي كانت حاضرة البحر", "وإذ نتقنا الجبل فوقهم كأنه ظلة", "ولله الأسماء الحسنى فادعوه بها", "قل لا أملك لنفسي نفعا ولا ضرا إلا ما شاء الله", "خذ العفو وأمر بالعرف وأعرض عن الجاهلين",
            "كما أخرجك ربك من بيتك بالحق وإن فريقا من المؤمنين لكارهون", "إذ يوحي ربك إلى الملائكة أني معكم فثبتوا الذين آمنوا", "إن شر الدواب عند الله الصم البكم الذين لا يعقلون", "وإذ قالوا اللهم إن كان هذا هو الحق من عندك فأمطر علينا حجارة", "واعلموا أنما غنمتم من شيء فأن لله خمسه وللرسول", "إذ يقول المنافقون والذي في قلوبهم مرض غر هؤلاء دينهم", "وأعدوا لهم ما استطعتم من قوة ومن رباط الخيل", "إن الذين آمنوا وهاجروا وجاهدوا بأموالهم وأنفسهم", "فإذا انسلخ الأشهر الحرم فاقتلوا المشركين حيث وجدتموهم", "وإن نكثوا أيمانهم من بعد عهدهم وطعنوا في دينكم",
            "أجعلتم سقاية الحاج وعمارة المسجد الحرام كمن آمن بالله", "لقد نصركم الله في مواطن كثيرة ويوم حنين", "يا أيها الذين آمنوا إن كثيرا من الأحبار والرهبان ليأكلون أموال", "إلا تنصروه فقد نصره الله", "ولو أرادوا الخروج لأعدوا له عدة", "وما منعهم أن تقبل منهم نفقاتهم إلا أنهم كفروا", "ومنهم الذين يؤذون النبيء ويقولون هو أذن", "ألم يأتهم نبأ الذين من قبلهم قوم نوح وعاد وثمود", "ومنهم من عاهد الله لئن آتانا من فضله لنصدقن", "ولا تصل على أحد منهم مات أبدا ولا تقم على قبره",
            "إنما السبيل على الذين يستأذنونك وهم أغنياء", "وممن حولكم من الأعراب منافقون ومن أهل المدينة", "إن الله اشترى من المؤمنين أنفسهم وأموالهم بأن لهم الجنة", "لقد تاب الله على النبيء والمهاجرين والأنصار الذين اتبعوه", "يا أيها الذين ءامنوا قاتلوا الذين يلونكم من الكفار", "إن ربكم الله الذي خلق السماوات والأرض في ستة أيام", "ولو يعجل الله للناس الشر استعجالهم بالخير لقضي إليهم أجلهم", "وما كان الناس إلا أمة واحدة فاختلفوا", "للذين أحسنوا الحسنى وزيادة", "وما كان هذا القرآن أن يفترى من دون الله",
            "قل لا أملك لنفسي ضرا ولا نفعا إلا ما شاء الله", "وما تكون في شأن وما تتلوا منه من قرآن", "واتل عليهم نبأ نوح إذ قال لقومه يا قوم إن كان كبر عليكم مقامي", "فما آمن لموسى إلا ذرية من قومه على خوف من فرعون", "ولقد بوأنا بني إسرائيل مبوأ صدق ورزقناهم من الطيبات", "قل يا أيها الناس إن كنتم في شك من ديني", "وما من دابة في الأرض إلا على الله رزقها", "من كان يريد الحياة الدنيا وزينتها نوف إليهم أعمالهم فيها", "مثل الفريقين كالأعمى والأصم والبصير السميع", "قالوا يا نوح قد جادلتنا فأكثرت جدالنا فأتنا بما تعدنا",
            "وقال اركبوا فيها بسم الله مجراها ومرساها", "وإلى عاد أخاهم هودا قال يا قوم اعبدوا الله", "قالوا يا صالح قد كنت فينا مرجوا قبل هذا", "فلما ذهب عن إبراهيم الروع وجاءته البشرى", "وإلى مدين أخاهم شعيبا قال يا يقوم اعبدوا الله", "ولما جا أمرنا نجينا شعيبا والذين آمنوا معه", "يوم يأتي لا تكلم نفس إلا بإذنه", "وكلا نقص عليك من أنباء الرسل ما نثبت به فؤادك", "قال قآئل منهم لا تقتلوا يوسف وألقوه في غيابات الجب", "ولما بلغ أشده آتيناه حكما وعلما",
            "قال رب السجن أحب إلي مما يدعونني إليه", "وقال الملك إني أرى سبع بقرات سمان", "وما أبرئ نفسي إن النفس لأمارة بالسوء إلا ما رحم ربي", "وقال يا بني لا تدخلوا من باب واحد وادخلوا من أبواب متفرقة", "قالوا إن يسرق فقد سرق أخ له من قبل", "فلما دخلوا عليه قالوا يا أيها العزيز مسنا وأهلنا الضر", "رب قد آتيتني من الملك وعلمتني من تأويل الأحاديث", "حتى إذا استيأس الرسل وظنوا أنهم قد كذبوا", "وإن تعجب فعجب قولهم", "قل من رب السماوات والأرض قل الله",
            "أفمن يعلم أنما أنزل إليك من ربك الحق كمن هو أعمى", "كذلك أرسلناك في أمة قد خلت من قبلها أمم", "مثل الجنة التي وعد المتقون تجري من تحتها الأنهار", "ألر كتاب أنزلناه إليك لتخرج الناس من الظلمات إلى النور", "قالت رسلهم أفي الله شك فاطر السماوات والأرض", "ألم تر أن الله خلق السماوات والأرض بالحق", "ألم تر إلى الذين بدلوا نعمة الله كفرا", "الحمد لله الذي وهب لي على الكبر إسماعيل وإسحاق", "ألر تلك آيات الكتاب وقرآن مبين ربما يود الذين كفروا", "ولقد خلقنا الإنسان من صلصال من حمإ مسنون",
            "نبئ عبادي أني أنا الغفور الرحيم", "ولقد كذب أصحاب الحجر المرسلين", "أتى أمر الله فلا تستعجلوه", "وألقى في الأرض رواسي أن تميد بكم", "وقيل للذين اتقوا ماذا أنزل ربكم", "وأقسموا بالله جهد أيمانهم لا يبعث الله من يموت", "وقال الله لا تتخذوا إلهين اثنين إنما هو إله واحد", "تالله لقد أرسلنا إلى أمم من قبلك فزين لهم الشيطان أعمالهم", "والله فضل بعضكم على بعض في الرزق", "ألم يروا إلى الطير مسخرات في جو السماء",
            "إن الله يأمر بالعدل والإحسان وإيتاء ذي القربى", "فإذا قرأت القرآن فاستعذ بالله من الشيطان الرجيم", "يوم تأتي كل نفس تجادل عن نفسها", "إن إبراهيم كان أمة قانتا لله حنيفا ولم يك من المشركين", "سبحان الذي أسرى بعبده ليلا", "ويدع الإنسان بالشر دعاءه بالخير", "وقضى ربك ألا تعبدوا إلا إياه وبالوالدين إحسانا", "ولا تقف ما ليس لك به علم", "قل كونوا حجارة أو حديدا", "وإذ قلنا للملائكة اسجدوا لآدم فسجدوا إلا إبليس قال أأسجد",
            "ولقد كرمنا بني آدم وحملناهم في البر والبحر", "ويسألونك عن الروح قل الروح من أمر ربي", "أولم يروا أن الله الذي خلق السماوات والأرض قادر", "الحمد لله الذي أنزل على عبده الكتاب ولم يجعل له عوجا", "وترى الشمس إذا طلعت تزاور عن كهفهم ذات اليمين", "فلا تمار فيهم إلا مراء ظاهرا", "واضرب لهم مثلا رجلين جعلنا لأحدهما جنتين", "واضرب لهم مثل الحياة الدنيا كماء أنزلناه من السماء", "ولقد صرفنا في هذا القرآن للناس من كل مثل", "قال ذلك ما كنا نبغ فارتدا على آثارهما قصصا",
            "قال ألم أقل لك إنك لن تستطيع معي صبرا", "ويسألونك عن ذي القرنين قل سأتلوا عليكم منه ذكرا", "وتركنا بعضهم يومئذ يموج في بعض", "كهيعص ذكر رحمة ربك عبده زكرياء", "فحملته فانتبذت به مكانا قصيا", "واذكر في الكتاب إبراهيم إنه كان صديقا نبيئا", "فخلف من بعدهم خلف أضاعوا الصلاة واتبعوا الشهوات", "أفرأيت الذي كفر بآياتنا وقال لأوتين مالا وولدا", "طه ما أنزلنا عليك القرآن لتشقى", "قال رب اشرح لي صدري",
            "منها خلقناكم وفيها نعيدكم ومنها نخرجكم تارة أخرى", "قالوا لن نؤثرك على ما جاءنا من البينات", "وما أعجلك عن قومك يا موسى", "قال فما خطبك يا سامري", "وعنت الوجوه للحي القيوم وقد خاب من حمل ظلما", "أفلم يهد لهم كم أهلكنا قبلهم من القرون", "اقترب للناس حسابهم وهم في غفلة معرضون", "وما خلقنا السماء والأرض وما بينهما لاعبين", "أولم ير الذين كفروا أن السماوات والأرض كانتا رتقا ففتقناهما", "قل من يكلؤكم بالليل والنهار من الرحمن",
            "ولقد آتينا إبراهيم رشده من قبل", "ولوطا آتيناه حكما وعلما", "وذا النون إذ ذهب مغاضبا فظن أن لن نقدر عليه", "إن الذين سبقت لهم منا الحسنى", "يا أيها الناس اتقوا ربكم إن زلزلة الساعة شيء عظيم", "ومن الناس من يعبد الله على حرف", "هذان خصمان اختصموا في ربهم", "ذلك ومن يعظم حرمات الله فهو خير له", "إن الله يدافع عن الذين آمنوا", "قل يا أيها الناس إنما أنا لكم نذير مبين",
            "ذلك ومن عاقب بمثل ما عوقب به", "ألم تعلم أن الله يعلم ما في السماء والأرض", "قد أفلح المؤمنون", "وإن لكم في الأنعام لعبرة", "هيهات هيهات لما توعدون", "إن الذين هم من خشية ربهم مشفقون", "ولو رحمناهم وكشفنا ما بهم من ضر", "وقل رب أعوذ بك من همزات الشياطين", "أفحسبتم أنما خلقناكم عبثا وأنكم إلينا لا ترجعون", "إن الذين جاءوا بالإفك عصبة منكم",
            "يا أيها الذين آمنوا لا تتبعوا خطوات الشيطان", "قل للمؤمنين يغضوا من أبصارهم ويحفظوا فروجهم", "الله نور السماوات والأرض", "ألم تر أن الله يزجي سحابا ثم يؤلف بينه", "وأقسموا بالله جهد أيمانهم لئن أمرتهم ليخرجن", "والقواعد من النساء اللاتي لا يرجون نكاحا", "لا تجعلوا دعاء الرسول بينكم كدعاء بعضكم بعضا", "تبارك الذي إن شاء جعل لك خيرا من ذلك", "وقال الذين لا يرجون لقاءنا لولا أنزل علينا الملائكة", "وقال الذين كفروا لولا نزل عليه القرآن جملة",
            "ألم تر إلى ربك كيف مد الظل", "تبارك الذي جعل في السماء بروجا", "طسم تلك آيات الكتاب المبين لعلك باخع نفسك", "قال فرعون وما رب العالمين", "قالوا لا ضير إنا إلى ربنا منقلبون", "الذي خلقني فهو يهدين", "قالوا أنؤمن لك واتبعك الأرذلون", "أتتركون في ما هاهنا آمنين", "أوفوا الكيل ولا تكونوا من المخسرين", "وما أهلكنا من قرية إلا لها منذرون",
            "وإنك لتلقى القرآن من لدن حكيم عليم", "حتى إذ أتوا على واد النمل قالت نملة", "قال سننظر أصدقت أم كنت من الكاذبين", "قال نكروا لها عرشها", "قل الحمد لله وسلام على عباده الذين اصطفى", "وقال الذين كفروا إذا كنا ترابا وآباؤنا", "وإذا وقع القول عليهم أخرجنا لهم دابة من الأرض", "طسم تلك آيات الكتاب المبين نتلو عليك من نبإ موسى", "وحرمنا عليه المراضع من قبل", "وجاء رجل من أقصا المدينة يسعى قال يا موسى",
            "فلما قضى موسى الأجل وسار بأهله", "وقال فرعون يا أيها الملأ ما علمت لكم من إله غيري", "ولقد وصلنا لهم القول لعلهم يذكرون", "أفمن وعدناه وعدا حسنا فهو لاقيه", "إن قارون كان من قوم موسى فبغى عليهم", "تلك الدار الآخرة نجعلها للذين لا يريدون علوا في الأرض و لا فسادا", "ووصينا الإنسان بوالديه حسنا وإن جاهداك على أن تشرك بي", "وإبراهيم إذ قال لقومه اعبدوا الله واتقوه", "فآمن له لوط", "وإلى مدين أخاهم شعيبا",
            "ولا تجادلوا أهل الكتاب إلا بالتي هي أحسن", "وكأين من دابة لا تحمل رزقها الله يرزقها وإياكم", "أولم يسيروا في الأرض فينظروا كيف كان عاقبة الذين من قبلهم", "ومن آياته خلق السماوات والأرض واختلاف ألسنتكم", "منيبين إليه واتقوه وأقيموا الصلاة", "ظهر الفساد في البر والبحر بما كسبت أيدي الناس", "الله الذي خلقكم من ضعف ثم جعل من بعد ضعف قوة", "ولقد آتينا لقمان الحكمة أن أشكر لله", "ومن يسلم وجهه لله وهو محسن", "وإذ غشيهم موج كالظلل دعوا الله",
            "قل يتوفاكم ملك الموت الذي وكل بكم", "ولقد آتينا موسى الكتاب فلا تكن في مرية من لقائه", "النبيء أولى بالمؤمنين من أنفسهم", "وإذ قالت طائفة منهم يا أهل يثرب لا مقام لكم", "يحسبون الأحزاب لم يذهبوا", "يا أيها النبيء قل لأزواجك إن كنتن تردن الحياة الدنيا", "إن المسلمين والمسلمات والمؤمنين والمؤمنات", "ما كان محمد أبا أحد من رجالكم", "ترجي من تشاء منهن وتؤوي إليك من تشاء", "لا جناح عليهن في آباءهن ولا أبنائهن ولا إخوانهن",
            "لئن لم ينته المنافقون والذين في قلوبهم مرض", "إنا عرضنا الأمانة على السماوات والأرض والجبال", "وقال الذين كفروا هل ندلكم على رجل", "لقد كان لسبإ في مساكنهم آية", "قل من يرزقكم من السماوات والأرض قل الله", "وما أرسلنا في قرية من نذير إلا قال مترفوها", "قل إنما أعظكم بواحدة", "يا أيها الناس إن وعد الله حق", "يا أيها الناس أنتم الفقراء إلى الله", "والذي أوحينا إليك من الكتاب هو الحق",
            "قل أرأيتم شركاءكم الذين تدعون من دون الله", "يس والقرآن الحكيم", "وما أنزلنا على قومه من بعده من جند من السماء", "وإذا قيل لهم اتقوا ما بين أيديكم وما خلفكم لعلكم ترحمون", "ألم أعهد إليكم يا بني آدم ألا تعبدوا الشيطان", "أولم ير الإنسان أنا خلقناه من نطفة", "احشروا الذين ظلموا وأزواجهم وما كانوا يعبدون", "قال قائل منهم إني كان لي قرين", "وإن من شيعته لإبراهيم", "ولقد مننا على موسى وهارون",
            "فنبذناه بالعراء وهو سقيم", "ص والقرآن ذي الذكر", "وهل أتاك نبأ الخصم إذ تسورا المحراب", "ووهبنا لداوود سليمان", "وعندهم قاصرات الطرف أتراب", "قال فالحق والحق أقول", "وإذ مس الإنسان ضر دعا ربه منيبا إليه", "أفمن حق عليه كلمة العذاب", "فمن أظلم ممن كذب على الله وكذب بالصدق", "أم اتخذوا من دون الله شفعاء",
            "قل يا عبادي الذي أسرفوا على أنفسهم", "وما قدروا الله حق قدره والأرض جميعا قبضته", "حم تنزيل الكتاب من الله العزيز العليم غافر الذنب", "إن الذين كفروا ينادون لمقت الله أكبر من مقتكم أنفسكم", "أولم يسيروا في الأرض فينظروا كيف كان عاقبة الذين كانوا", "وقال الذي آمن يا قوم إني أخاف عليكم مثل يوم الأحزاب", "ويا قومي مالي أدعوكم إلى النجاة وتدعونني إلى النار", "ولقد آتينا موسى الهدى وأورثنا بني إسرائيل الكتاب", "قل إني نهيت أن أعبد الذي تدعون من دون الله", "الله الذي جعل لكم الأنعام لتركبوا منها ومنها تأكلون",
            "قل أإنكم لتكفرون بالذي خلق الأرض في يومين", "وأما ثمود فهديناهم فاستحبوا العمى على الهدى", "وقال الذين كفروا لا تسمعوا لهذا القرآن والغوا فيه", "فإن استكبروا فالذين عند ربك يسبحون له بالليل والنهار", "إليه يرد علم الساعة", "حم عسق كذلك يوحي إليك وإلى الذين من قبلك الله العزيز الحكيم", "شرع لكم من الدين ما وصى به نوحا", "أم لهم شركاء شرعوا لهم من الدين ما لم يأذن به الله", "أو يوبقهن بما كسبوا ويعف عن كثير", "ولمن صبر وغفر إن ذلك لمن عزم الأمور",
            "وما كان لبشر أن يكلمه الله إلا وحيا أو من وراء حجاب", "والذي خلق الأزواج كلها وجعل لكم من الفلك والأنعام ما تركبون", "قل أولو جئتكم بأهدى مما وجدتم عليه آباءكم", "فاستمسك بالذي أوحي إليك", "ولما جاء عيسى بالبينات قال قد جئتكم بالحكمة", "وهو الذي في السماء إله وفي الأرض إله", "كم تركوا من جنات وعيون وزروع ومقام كريم", "إن المتقين في مقام أمين", "هذا هدى والذين كفروا بآيات ربهم لهم عذاب من رجز أليم", "أفرأيت من اتخذ إلهه هواه وأضله الله على علم",
            "حم تنزيل الكتاب من الله العزيز الحكيم", "ووصينا الإنسان بوالديه حسنا", "واذكر أخا عاد إذ أنذر قومه بالأحقاف", "أولم يروا أن الله الذي خلق السماوات والأرض ولم يعي بخلقهن", "أفلم يسيروا في الأرض فينظروا كيف كان عاقبة الذين من قبلهم", "ويقول الذين آمنوا لولا نزلت سورة", "يا أيها الذين آمنوا أطيعوا الله وأطيعوا الرسول ولا تبطلوا أعمالكم", "إنا أرسلناك شاهدا ومبشرا ونذيرا", "لقد رضي الله عن المؤمنين إذ يبايعونك تحت الشجرة", "لقد صدق الله رسوله الرؤيا بالحق",
            "يا أيها الذين آمنوا لا تقدموا بين يدي الله ورسوله", "وإن طائفتان من المؤمنين اقتتلوا", "قالت الأعراب آمنا", "أفلم ينظروا إلى السماء فوقهم", "قال قرينه ربنا ما أطغيته", "والذاريات ذروا", "قال فما خطبكم أيها المرسلون", "وما خلقت الجن والإنس إلا ليعبدون", "ويطوف عليهم غلمان لهم كأنهم لؤلؤ مكنون", "وإن يروا كسفا من السماء ساقطا",
            "وكم من ملك في السماوات لا تغني شفاعتهم شيئا", "هذا نذير من النذر الأولى", "كذبت عاد فكيف كان عذابي ونذر", "ولقد جا آل فرعون النذر", "الرحمن علم القرآن", "يا معشر الجن والإنس إن استطعتم أن تنفذوا", "هل جزاء الإحسان إلا الإحسان", "وأصحاب اليمين", "فلا أقسم بمواقع النجوم", "آمنوا بالله ورسوله وأنفقوا مما جعلكم مستخلفين فيه",
            "ألم يأن للذين آمنوا أن تخشع قلوبهم", "ما أصاب من مصيبة في الأرض ولا في أنفسكم إلا في كتاب", "قد سمع الله قول التي تجادلك في زوجها", "ألم تر إلى الذين نهوا عن النجوى", "ألم تر إلى الذين تولوا قوما غضب الله عليهم", "سبح لله ما في السماوات وما في الأرض وهو العزيز الحكيم", "ألم تر إلى الذين نافقوا يقولون لإخوانهم الذين كفروا", "يا أيها الذين آمنوا لا تتخذوا عدوي وعدوكم أولياء", "عسى الله أن يجعل بينكم وبين الذين عاديتم منهم مودة", "سبح لله ما في السماوات وما في الأرض وهو العزيز الحكيم",
            "يسبح لله ما في السماوات وما في الأرض الملك القدوس", "يا أيها الذين آمنوا إذا نودي للصلاة من يوم الجمعة", "يا أيها الذين آمنوا لا تلهكم أموالكم ولا أولادكم", "زعم الذين كفروا أن لن يبعثوا قل بلى وربي لتبعثن", "يا أيها الذين آمنوا إن من أزواجكم وأولادكم عدوا لكم", "اسكنوهن من حيث سكنتم من وجدتكم", "الله الذي خلق سبع سماوات ومن الأرض مثلهن", "يا أيها الذين آمنوا توبوا إلى الله", "تبارك الذي بيده الملك", "أولم يروا إلى الطير فوقهم صافات",
            "فطاف عليها طائف من ربك", "الحاقة ما الحاقة", "فلا أقسم بما تبصرون وما لا تبصرون", "إن الإنسان خلق هلوعا", "فلا أقسم برب المشارق والمغارب", "ألم تر كيف خلق الله سبع سماوات طباقا", "قل أوحي إلى أنه استمع نفر من الجن", "وأن المساجد لله فلا تدعو مع الله أحدا", "إن ربك يعلم أنك تقوم أدنى من ثلي الليل", "وما جعلنا أصحاب النار إلا ملائكة",
            "لا أقسم بيوم القيامة", "هل أتى على الإنسان حين من الدهر", "ويطوف عليهم ولدان مخلدون", "ألم نهلك الأولين", "عم يتساءلون", "والنازعات غرقا", "يسألونك عن الساعة أيان مرساها", "فإذا جاءت الصاخة", "فلا أقسم بالخنس", "كلا إن كتاب الفجار لفي سجين",
            "فلا أقسم بالشفق", "إن بطش ربك لشديد", "سبح اسم ربك الأعلى", "أفلا ينظرون إلى الإبل كيف خلقت", "لا أقسم بهذا البلد", "والليل إذا يغشى", "ألم نشرح لك صدرك", "إنا أنزلناه في ليلة القدر", "أفلا يعلم إذا بعثر ما في القبور", "ألم تر كيف فعل ربك بأصحاب الفيل"
        ];
        
        const quranData = [];
        for (let i = 0; i < 60; i++) {
            const hizbAthman = [];
            for (let j = 0; j < 8; j++) {
                const thumnIndex = i * 8 + j;
                const title = thumnTitles[thumnIndex] || `الثمن ${thumnIndex + 1}`;
                hizbAthman.push({
                    title: title,
                    audio_file: `thumn_${String(thumnIndex + 1).padStart(3, '0')}.mp3`,
                    image_file: `thumn_${String(thumnIndex + 1).padStart(3, '0')}.jpg`
                });
            }
            const hizbName = thumnTitles[i * 8] ? `${String(i + 1).padStart(2, '0')}- ${thumnTitles[i * 8].substring(0, 40)}...` : `الحزب ${String(i + 1).padStart(2, '0')}`;
            quranData.push({
                hizb_number: i + 1,
                hizb_name: hizbName,
                athman: hizbAthman
            });
        }

        // State
        let currentHizbIndex = 0;
        let currentThumnIndex = -1;
        let isPlaying = false;
        
        function populateHizbSelector() {
            hizbSelector.innerHTML = '';
            quranData.forEach((hizb, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = hizb.hizb_name;
                hizbSelector.appendChild(option);
            });
            hizbSelector.value = currentHizbIndex;
        }
        
        function populateAthmanListForHizb(hizbIndex) {
            const hizb = quranData[hizbIndex];
            athmanList.innerHTML = '';
            hizb.athman.forEach((thumn, thumnIndex) => {
                const li = document.createElement('li');
                li.className = 'athman-list-item';
                li.dataset.hizbIndex = hizbIndex;
                li.dataset.thumnIndex = thumnIndex;
                const globalThumnNumber = hizbIndex * 8 + thumnIndex + 1;
                li.textContent = String(globalThumnNumber).padStart(3, '0');
                li.title = thumn.title;
                
                li.addEventListener('click', () => {
                    if (currentHizbIndex !== hizbIndex || currentThumnIndex !== thumnIndex) {
                        currentHizbIndex = hizbIndex;
                        currentThumnIndex = thumnIndex;
                        loadThumn(true);
                    }
                });
                athmanList.appendChild(li);
            });
            updateActiveListItem();
        }

        function loadThumn(playImmediately = false) {
            if (currentHizbIndex < 0 || currentThumnIndex < 0) return;
            
            const hizb = quranData[currentHizbIndex];
            const thumn = hizb.athman[currentThumnIndex];

            if (searchInput.value === '') { 
                populateAthmanListForHizb(currentHizbIndex);
            }
            currentThumnTitle.textContent = thumn.title;
            
            const audioPath = `audio/${encodeURIComponent(thumn.audio_file)}`;
            const imagePath = `images/${encodeURIComponent(thumn.image_file)}`;

            audioPlayer.src = GITHUB_RAW_BASE_URL + audioPath;
            quranImage.src = GITHUB_RAW_BASE_URL + imagePath;
            
            quranImage.onerror = () => {
                quranImage.src = 'https://via.placeholder.com/1200x1800/FFFFFF/2E86C1?text=خطأ+في+تحميل+الصورة';
            };

            if (playImmediately) {
                audioPlayer.play().catch(e => {
                    console.error("Audio Playback Error:", e);
                    currentThumnTitle.textContent = "خطأ: لم يتم العثور على الملف الصوتي";
                });
            }
        }

        function handleSearch(query) {
            athmanList.innerHTML = '';
            if (!query) {
                populateAthmanListForHizb(currentHizbIndex);
                return;
            }
            quranData.forEach((hizb, hizbIndex) => {
                hizb.athman.forEach((thumn, thumnIndex) => {
                    if (thumn.title.includes(query)) {
                        const li = document.createElement('li');
                        li.className = 'athman-list-item';
                        li.textContent = `(${hizb.hizb_number}) ${thumn.title.substring(0,25)}...`;
                        li.title = thumn.title;
                        li.addEventListener('click', () => {
                            currentHizbIndex = hizbIndex;
                            currentThumnIndex = thumnIndex;
                            hizbSelector.value = hizbIndex;
                            searchInput.value = '';
                            loadThumn(true);
                        });
                        athmanList.appendChild(li);
                    }
                });
            });
        }
        
        function updateActiveListItem() {
            const listItems = athmanList.querySelectorAll('.athman-list-item');
            listItems.forEach(item => {
                const hizbIdx = parseInt(item.dataset.hizbIndex);
                const thumnIdx = parseInt(item.dataset.thumnIndex);
                if (hizbIdx === currentHizbIndex && thumnIdx === currentThumnIndex) {
                    item.classList.add('active');
                    item.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                } else {
                    item.classList.remove('active');
                }
            });
        }

        function formatTime(seconds) {
            if(isNaN(seconds)) return "0:00";
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
        }
        
        async function downloadHizbAsZip() {
            loadingOverlay.textContent = "جاري تحضير الملفات...";
            loadingOverlay.style.display = 'flex';
            
            const hizb = quranData[currentHizbIndex];
            const zip = new JSZip();
            
            try {
                for (const thumn of hizb.athman) {
                     const url = `${GITHUB_RAW_BASE_URL}audio/${encodeURIComponent(thumn.audio_file)}`;
                     const response = await fetch(url);
                     if (!response.ok) throw new Error(`Failed to fetch ${thumn.audio_file}`);
                     const blob = await response.blob();
                     const cleanTitle = thumn.title.replace(/[\\/:\*?"<>|]/g, '');
                     zip.file(`${cleanTitle}.mp3`, blob);
                }
                
                loadingOverlay.textContent = "جاري ضغط الملفات...";
                const content = await zip.generateAsync({type:"blob"});
                const cleanHizbName = hizb.hizb_name.replace(/[\\/:\*?"<>|]/g, '');
                saveAs(content, `${cleanHizbName}.zip`);
                loadingOverlay.textContent = "اكتمل التحميل!";
            } catch (error) {
                loadingOverlay.textContent = "حدث خطأ أثناء تحميل الملفات.";
                console.error(error);
            } finally {
                setTimeout(() => { 
                    loadingOverlay.style.display = 'none'; 
                    loadingOverlay.textContent = '';
                }, 2000);
            }
        }

        // --- Event Listeners ---
        hizbSelector.addEventListener('change', (e) => {
            searchInput.value = '';
            currentHizbIndex = parseInt(e.target.value);
            currentThumnIndex = -1;
            currentThumnTitle.textContent = 'اختر ثمنًا من الشريط أعلاه';
            populateAthmanListForHizb(currentHizbIndex);
        });
        
        searchInput.addEventListener('input', (e) => handleSearch(e.target.value));
        downloadHizbBtn.addEventListener('click', downloadHizbAsZip);

        playPauseBtn.addEventListener('click', () => {
            if (currentThumnIndex < 0 && quranData[currentHizbIndex].athman.length > 0) { 
                currentThumnIndex = 0;
                loadThumn(true);
                return;
            }
            if (audioPlayer.paused) { audioPlayer.play(); } else { audioPlayer.pause(); }
        });
        
        audioPlayer.addEventListener('play', () => { isPlaying = true; playPauseBtn.textContent = '⏸'; });
        audioPlayer.addEventListener('pause', () => { isPlaying = false; playPauseBtn.textContent = '⏯'; });
        
        audioPlayer.addEventListener('timeupdate', () => {
            if (audioPlayer.duration) {
                timeline.value = audioPlayer.currentTime;
                currentTimeEl.textContent = formatTime(audioPlayer.currentTime);
            }
        });
        audioPlayer.addEventListener('loadedmetadata', () => {
             timeline.max = audioPlayer.duration;
             totalTimeEl.textContent = formatTime(audioPlayer.duration);
        });

        timeline.addEventListener('input', () => { audioPlayer.currentTime = timeline.value; });

        function playNext() {
            currentThumnIndex++;
            if (currentThumnIndex >= quranData[currentHizbIndex].athman.length) {
                currentHizbIndex++;
                if (currentHizbIndex >= quranData.length) {
                    currentHizbIndex = 0; 
                }
                currentThumnIndex = 0;
                hizbSelector.value = currentHizbIndex;
            }
            loadThumn(isPlaying);
        }

        function playPrev() {
            currentThumnIndex--;
            if (currentThumnIndex < 0) {
                currentHizbIndex--;
                if (currentHizbIndex < 0) {
                    currentHizbIndex = quranData.length - 1; 
                }
                currentThumnIndex = quranData[currentHizbIndex].athman.length - 1;
                hizbSelector.value = currentHizbIndex;
            }
            loadThumn(isPlaying);
        }

        nextBtn.addEventListener('click', playNext);
        prevBtn.addEventListener('click', playPrev);
        speedControl.addEventListener('change', (e) => audioPlayer.playbackRate = parseFloat(e.target.value));
        audioPlayer.addEventListener('ended', () => {
            let repeatCount = parseInt(repeatCountInput.value, 10);
            if (repeatCount > 1) {
                repeatCountInput.value = repeatCount - 1;
                audioPlayer.currentTime = 0;
                audioPlayer.play();
            } else {
                repeatCountInput.value = 1;
                playNext();
            }
        });
        
        // --- Initial Load ---
        function init() {
            populateHizbSelector();
            populateAthmanListForHizb(currentHizbIndex);
        }

        init();
    </script>
</body>
</html>
